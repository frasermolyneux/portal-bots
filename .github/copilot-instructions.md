# Copilot Instructions

- Scope: Portal bots for XtremeIdiots game servers built on BigBrotherBot (B3). The repo packages the B3 runtime plus a custom portal plugin that forwards server telemetry to the portal API.
- Core plugin: [src/plugins/portal/__init__.py](src/plugins/portal/__init__.py) registers chat/team chat, player connect, map change, and startup events and posts them to `/OnChatMessage`, `/OnPlayerConnected`, `/OnMapChange`, and `/OnServerConnected`. Commands `!like`/`!dislike` post map votes to `/OnMapVote`.
- Auth and retries: The plugin uses AAD client credentials (tenant/client id/secret/scope) to fetch a bearer token via `https://login.microsoftonline.com/{tenant}/oauth2/v2.0/token`. API calls use `requests` with retry/backoff; failures enqueue to a local spool file so events can replay once connectivity returns.
- Configuration: Template configs live in [src/conf_templates](src/conf_templates). [plugin_portal_gameType_serverId.ini](src/conf_templates/plugin_portal_gameType_serverId.ini) holds game type, server ID, APIM base URL, AAD creds, certificate path for TLS verification, and `spoolPath`. [gameType_serverId.ini](src/conf_templates/gameType_serverId.ini) wires B3 bot metadata and points the portal plugin config into `conf`.
- Runtime layout: [src](src) contains the bundled Windows B3 distribution (Python 2.7 binaries, plugins, configs). Plugin configs under [src/conf](src/conf) are populated per server; external plugins live in [src/extplugins](src/extplugins) and standard plugins under [src/plugins](src/plugins).
- Event schema references: See [docs/b3-events-documentation.md](docs/b3-events-documentation.md) for the full B3 event catalogue and portal capture points, and [docs/player-and-communication-events.md](docs/player-and-communication-events.md) for the curated lifecycle/communication events with example payloads.
- Operational notes: Ensure `spoolPath` is writable to persist offline events; TLS verification uses the configured PEM path. The plugin relies on the B3 admin plugin being loaded; map vote commands are registered with admin level 1 by default.
- Build/run: There is no .NET/Node build; this repo is configuration and plugin code. Deployment typically involves packaging the `src` directory to the target B3 host and applying server-specific configs from `conf_templates`.
- Contribution hygiene: When changing plugin behavior, update the docs under [docs](docs) to keep event schemas current. No automated tests existâ€”validate changes against a running B3 instance.
